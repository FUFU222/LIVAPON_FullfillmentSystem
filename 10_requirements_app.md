# Requirements: Shopify 配送管理アプリ (MVP)

## 概要

CHAIRMAN 向けに、Shopify 注文データを同期し、メーカー（ベンダー）が注文ごとの配送状況を更新できるアプリを開発する。  
初期 MVP では **個別更新 UI + CSV インポート** による追跡番号管理を提供し、将来的に配送会社 API との自動連携を目指す。

---

## ユースケース

1. Shopify で注文が発生すると、自作アプリに同期される。
2. ベンダーは管理画面から注文を確認。
3. 注文ごとに追跡番号を入力して「発送済み」に更新できる。
4. 注文が多い場合は、CSV インポートで一括登録が可能。
5. 更新内容は Shopify 側へ反映される（ステータス：Unfulfilled / Partially Fulfilled / Fulfilled）。

---

## 機能要件

### 1. 注文データの同期

- Shopify Webhook (orders/create, orders/updated)
- 1 日 1 回 API で全件リフレッシュ（整合性確保）

### 2. 注文管理 UI

- **注文一覧画面**
  - 注文番号 / 顧客名 / 商品数 / ステータス / 追跡番号 / 詳細リンク
  - 検索・フィルタ（ステータス別）
  - ページネーション
- **注文詳細画面**
  - 各商品ごとに追跡番号を登録・編集
  - ステータス操作は「発送済みにする」「未発送に戻す」の 2 アクションを提供（部分発送は将来拡張）

### 3. CSV インポート

- CSV フォーマット：  
  `order_number, sku, tracking_number, carrier`
- UI：ファイル選択 + アップロードボタン
- アップロード後にプレビューを表示（先頭数行）
- 成功/失敗をアラート表示（失敗は理由付き）

### 4. ステータス管理

- 現在：ベンダー操作は発送済み ⇔ 未発送の切り替えに限定（部分発送は表示のみ想定）
- 将来拡張：返品・交換 → 1 注文に複数 shipment を紐付け可能 / 部分発送の正式対応

### 5. ベンダー対応

- 初期は手動入力 or CSV
- 将来的に配送 API（ヤマト B2 / 佐川 e 飛伝 / DHL / FedEx）と連携予定

---

## 非機能要件

- 技術スタック：Next.js + Supabase + shadcn/ui
- デザイン方針：白黒基調のシンプルモダン
- エラーハンドリング：失敗時は即座に UI で通知
- セキュリティ：
  - ベンダーごとにデータを隔離
  - Shopify OAuth 認証によるアプリ連携
- パフォーマンス：1000 件程度の注文一覧をスムーズに操作可能
- 将来拡張性：配送 API や返品フロー追加を考慮したスキーマ設計

---

## 今後の拡張計画

- 配送会社 API との自動連携
- 返品・再発送対応
- Shopify の UI 拡張（App Extension）
- 多言語対応（ベンダーが海外拠点でも利用可能に）
