# UI通知・ダイアログ利用ガイド

## 目的
このドキュメントは、LIVAPON Fulfillment System におけるトースト通知・モーダルダイアログなどの一時的なフィードバック手段の使い分けと実装指針を整理するものです。ユーザー体験の一貫性とアクセシビリティ準拠を確保し、開発時の判断コストを下げることを狙いとしています。

## パターン選択の基本
| ユースケース | 推奨パターン | 理由・補足 |
| --- | --- | --- |
| 成功・警告など低リスクの非同期結果 | トースト（再読み込み不要） | 画面操作を妨げずに完了を伝えられる。重要度が低く確認が必須でない場合に限定。citeturn0search4turn0search10 |
| 即時にユーザー操作が必要な確認・意思決定 | モーダルダイアログ | 背景操作をブロックしてフォーカスを強制。焦点制御と閉じる手段の提供が必須。citeturn0search0turn0search6 |
| 長期的に表示したいステータスやエラー | ページ内バナー / インラインメッセージ | 持続的な注意喚起が必要な場合はトーストでは不十分。citeturn0search8 |
| 大量アラートやリアルタイム更新 | アクティビティフィード / バッジ | トースト乱用を避け通知疲れを防止。citeturn0search8 |

## トースト通知のベストプラクティス
- **用いる場面**: 低～中重要度の結果（保存成功、バックグラウンド同期完了など）。推奨滞留時間は 2–5 秒。自動クローズでも「再試行」「取り消し」など必要な操作はワンアクションで提供する。citeturn0search4turn0search10
- **避ける場面**: 決断が必要なクリティカルエラー、読み逃しが致命的な情報。これらはモーダルまたは常設バナーで提示する。citeturn0search8
- **UIルール**
  - 画面の右上を既定表示位置とし、重要 UI を遮らないよう最大 2 件まで同時表示。citeturn0search4
  - タイトル + 1 行程度の本文に収め、説明が長くなる場合はリンクで詳細へ誘導。
  - 「成功」「警告」など意味色は控えめにし、アイコンで文脈を補強。citeturn0search4turn0search10
  - スクリーンリーダー向けに `aria-live="polite"` を使い、表示時に音声読み上げされるようにする。

## モーダルダイアログのベストプラクティス
- **用いる場面**: 破壊的操作の確認、個別レコードの詳細編集、ログインなど現在タスクに直結する決断。背景を操作不可にするため、乱用すると生産性を下げる点に注意。
- **避ける場面**: 単なる情報提示や大量入力。代わりにフルスクリーン画面やスライドオーバーを検討。
- **アクセシビリティ要件**
  - `role="dialog"`（または `alertdialog`）と `aria-modal="true"` を設定し、モーダル外コンテンツを操作不可にする。citeturn0search0turn0search6
  - オープン時は最も頻用される操作またはタイトルへフォーカスを移し、`Tab` キーでフォーカスが循環するようにする。citeturn0search1turn0search7
  - `Esc` キーと明示的な「閉じる」ボタンを提供し、閉じた後はトリガー要素へフォーカスを戻す。citeturn0search2turn0search9
  - 背景を `inert`/`aria-hidden` にするだけでなく、タブ移動できないよう tabindex を管理する。citeturn0search2turn0search5

## その他の通知手段
- **バナー（ページ上部）**: システム全体に影響するメンテナンス情報や長時間表示が必要な警告に使用。
- **インラインメッセージ**: 入力フォームのバリデーションや特定コンポーネント内の状態メッセージに最適。
- **タスクフィード / アクティビティログ**: 複数イベントを後追い確認したい要件では、永続的ログを別画面またはサイドパネルで提供。

## LIVAPON Fulfillment System への適用
1. **トースト実装**
   - `ToastProvider` をレイアウト直下に配置済み。画面ごとに `useToast` を呼び出し、冪等なトースト ID を渡すことで重複表示を防ぐ。
   - 「更新中」など長時間表示は `duration: Infinity` で開始し、完了時に手動で `dismissToast` → 成功トーストを表示する（`OrdersRefreshButton` 実装が参照例）。
2. **モーダル実装**
   - 既存の `components/ui/confirm-dialog.tsx` をベースに、上記アクセシビリティ要件を満たすよう確認。テストではフォーカストラップ、`Esc` キー、トリガー復帰を含める。
3. **設計レビュー時のチェックリスト**
   - 通知の「重要度」「必要アクション」「持続時間」を整理し、パターン選択表に照らして妥当性を確認。
   - アクセシビリティ QA ではスクリーンリーダー（VoiceOver + Safari、NVDA + Firefox）でトーストとモーダルの読み上げを確認。
   - エラー通知は UI 変化（例: 行の削除）と重複しないようにし、冗長表示を避ける。citeturn0search8

## 今後の拡張案
- トースト履歴をアクティビティログに集約し、ユーザーが見逃した通知を後から参照できるようにする。
- グローバルバナーコンポーネント（メンテナンス告知用）を `components/ui/banner.tsx` として共通化。
- 自動リフレッシュが必要な画面では、トーストよりも「最終更新時刻」表示 + 手動更新ボタンの組み合わせを標準パターンにする。

