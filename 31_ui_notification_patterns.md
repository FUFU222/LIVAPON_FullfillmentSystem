# UI 通知・ダイアログ利用ガイド

## 目的

このドキュメントは **LIVAPON Fulfillment System** における一時的なフィードバック UI（トースト通知・モーダルダイアログなど）の利用指針を整理するものです。  
目的は以下の 3 つです：

1. フィードバック手段の使い分けを明確化し、開発判断の迷いをなくす
2. ユーザー体験の一貫性と可読性を確保する
3. アクセシビリティ基準（WCAG 2.1 AA）に準拠した実装を担保する

---

## 1. パターン選択の原則

| ユースケース                   | 推奨パターン                       | 理由・補足                                                       |
| ------------------------------ | ---------------------------------- | ---------------------------------------------------------------- |
| 成功・警告など軽量な非同期結果 | **トースト（Toast）**              | 操作を妨げず、完了を即座に伝えられる。再試行不要なケースに限定。 |
| 即時の判断・確認が必要な操作   | **モーダルダイアログ（Dialog）**   | 背景操作をロックし、フォーカスを明確に誘導できる。               |
| 継続的に見せたい状態・注意喚起 | **バナー／インラインメッセージ**   | トーストでは読み逃しが発生するため、永続的に提示する。           |
| 多数のイベント・ログ確認       | **アクティビティフィード／バッジ** | トースト乱用を避け、ユーザーの情報過多を防ぐ。                   |

---

## 2. トースト通知（Toast）

### 🟢 用いる場面

- 保存・同期完了、軽度エラー、フォーム送信完了など。
- 表示時間は 2〜5 秒。内容が長い場合は「詳細を見る」リンクを設ける。

### 🔴 避ける場面

- 重要なエラーや確認が必要な処理。
- 確定操作・削除など、ユーザーの明示的同意を要する場合。

### ⚙️ 実装ルール

- 表示位置は **右上固定**。同時表示は最大 2 件まで。
- メッセージ構成は「タイトル + 1 行本文 + アイコン（任意）」。
- 成功：緑系／警告：黄系／エラー：赤系。ただし色だけに依存せずアイコン併用。
- `aria-live="polite"` を使用し、音声読み上げを有効化。
- ホバー中は自動消去を一時停止。
- 表示中に同一メッセージを連続出さないよう ID で制御（例：`toastId="order-sync"`）。

#### 💻 コード例（shadcn/ui）

```tsx
import { toast } from "sonner";

toast.success("注文データを更新しました");
toast.error("保存に失敗しました。再試行してください。");
3. モーダルダイアログ（Dialog）
🟢 用いる場面
破壊的操作（削除・確定）の確認

詳細編集やログイン、再認証など現在タスクに直結する意思決定

🔴 避ける場面
単なる情報提示や大量入力（→ スライドオーバーまたは専用ページに分離）

⚙️ アクセシビリティ実装要件
要件	内容
ARIA属性	role="dialog"（または alertdialog）＋ aria-modal="true"
フォーカス制御	オープン時に主要操作ボタンまたはタイトルへ移動。Tab移動はモーダル内で循環。
終了操作	Esc キー＋明示的な閉じるボタンを必須化。閉じたら元のトリガー要素へフォーカスを戻す。
背景制御	inert または aria-hidden を付与し、背景操作をブロック。
フォーカストラップ	@radix-ui/react-dialog や shadcn/ui の Dialog コンポーネントで自動管理可。

💻 コード例（shadcn/ui）
tsx
コードをコピーする
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";

<Dialog open={open} onOpenChange={setOpen}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>出荷を確定しますか？</DialogTitle>
    </DialogHeader>
    <p>この操作は取り消せません。</p>
    <Button onClick={handleConfirm}>確定</Button>
  </DialogContent>
</Dialog>
4. その他の通知手段
種類	用途	実装例
バナー	全システムに影響するメンテナンス・お知らせ	components/ui/banner.tsx
インラインメッセージ	フォームバリデーション、局所的なエラー	Alert コンポーネント
アクティビティフィード	履歴・非同期ジョブの追跡	サイドパネル／別ページ表示

5. LIVAPON実装での適用ポイント
✅ トースト
ToastProvider はルートレイアウト直下に配置済み。

コンポーネント内で useToast() を呼び出し、IDで重複を防止。

長時間処理（例：CSVインポート中）は duration: Infinity で表示し、完了時に手動Dismiss。

表示イベントはSupabaseアクション成功後に限定。

✅ モーダル
confirm-dialog.tsx に統一。

QAでは以下3点を確認：
① Tab移動範囲がモーダル内に限定されるか
② Escキーで閉じられるか
③ 閉じた後、元ボタンにフォーカス復帰しているか

6. 設計レビュー時のチェックリスト
 通知の「重要度」「持続時間」「必要アクション」が定義されている

 トーストとモーダルの選択が表に沿って妥当

 aria-* 属性とフォーカス制御の実装を確認

 アニメーション速度が200–300ms以内に収まっている

 VoiceOver／NVDAで読み上げを確認済み

 トースト重複・同時多発を防ぐIDロジック実装済み

7. 今後の拡張
トースト履歴を「アクティビティログ」に統合し、見逃した通知を再確認可能に。

GlobalBanner コンポーネントでメンテナンス／障害情報を共通化。

自動リロード画面ではトーストより「最終更新時刻 + 手動更新ボタン」パターンを標準化。

参考資料
Carbon Design System: Notification Pattern

Google Material 3: Dialogs & Snackbars

UX Movement: Usable Toasts

Medium: Accessibility Before You Get Toast-Happy

Sheri Byrne-Haber: Designing Toasts for Accessibility
```
